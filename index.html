<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="منصة LeenClasses التعليمية للمدرسين مع نظام تقارير متقدم وإدارة كاملة للطلاب والحصص">
  <title>LeenClasses - منصتك التعليمية المتكاملة</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Reset */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: "Cairo", sans-serif;
      background-color: #f9f9f9;
      color: #222;
      line-height: 1.6;
    }
    
    /* Skip link styles */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: #2c3e50;
      color: white;
      padding: 8px;
      z-index: 100;
      transition: top 0.3s;
    }
    
  .error-message {
    color: #e74c3c;
    text-align: center;
    margin-top: 10px;
    font-size: 0.9rem;
    padding: 8px;
    background-color: #fdecea;
    border-radius: 4px;
  }
    .skip-link:focus {
      top: 0;
    }
    
    /* Focus styles */
    a:focus, button:focus, input:focus, select:focus, textarea:focus {
      outline: 2px solid #3498db;
      outline-offset: 2px;
    }
    
    header {
      background-color: #2c3e50;
      color: white;
      padding: 40px 20px;
      background-image: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    h1, h2, h3 {
      color: #2c3e50;
      margin-bottom: 20px;
    }
    
    h1 {
      font-size: 2.5rem;
    }
    
    h2 {
      font-size: 2rem;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
      margin-bottom: 30px;
    }
    
    h3 {
      font-size: 1.5rem;
      color: #3498db;
    }
    
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 30px;
      margin: 40px 0;
    }
    
    .feature-card {
      background: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s;
      border-top: 4px solid #3498db;
    }
    
    .feature-card:hover {
      transform: translateY(-10px);
    }
    
    .feature-icon {
      font-size: 2.5rem;
      color: #3498db;
      margin-bottom: 15px;
    }
    
    .pricing-tables {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 30px;
      margin: 50px 0;
    }
    
    .pricing-table {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      position: relative;
    }
    
    .popular-tag {
      position: absolute;
      top: 0;
      left: 0;
      background: #e74c3c;
      color: white;
      padding: 5px 15px;
      font-weight: bold;
      border-bottom-right-radius: 5px;
    }
    
    .pricing-header {
      background: #2c3e50;
      color: white;
      padding: 25px;
      text-align: center;
    }
    
    .price {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 15px 0;
    }
    
    .price span {
      font-size: 1rem;
      font-weight: normal;
    }
    
    .pricing-body {
      padding: 25px;
    }
    
    .pricing-features {
      list-style: none;
      margin: 20px 0;
    }
    
    .pricing-features li {
      margin: 15px 0;
      padding-right: 30px;
      position: relative;
    }
    
    .pricing-features li:before {
      content: "\f00c";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
      color: #2ecc71;
      position: absolute;
      right: 0;
    }
    
    .pricing-features li.disabled:before {
      content: "\f00d";
      color: #e74c3c;
    }
    
    .cta {
      display: block;
      background: #3498db;
      color: white;
      text-align: center;
      padding: 15px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      font-size: 1.1rem;
      transition: background 0.3s;
      margin-top: 20px;
    }
    
    .cta:hover {
      background: #2980b9;
    }
    
    .testimonials {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 30px;
      margin: 50px 0;
    }
    
    .testimonial {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .testimonial-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .testimonial-img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      margin-left: 15px;
    }
    
    .testimonial-rating {
      color: #f39c12;
      margin: 10px 0;
    }
    
    .faq-item {
      background: white;
      border-radius: 10px;
      margin-bottom: 15px;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    .faq-question {
      padding: 20px;
      background: #f8f9fa;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .faq-answer {
      padding: 0 20px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s, padding 0.3s;
    }
    
    .faq-item.active .faq-answer {
      padding: 20px;
      max-height: 500px;
    }
    
    footer {
      background: #2c3e50;
      color: white;
      padding: 50px 20px;
      text-align: center;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin: 30px 0;
    }
    
    .footer-links a {
      color: #bdc3c7;
      text-decoration: none;
      transition: color 0.3s;
    }
    
    .footer-links a:hover {
      color: white;
    }
    
    .social-icons {
      margin: 20px 0;
    }
    
    .social-icons a {
      color: white;
      font-size: 1.5rem;
      margin: 0 10px;
    }
    
    /* أنماط جديدة */
    input, select, textarea {
      font-family: "Cairo", sans-serif;
      transition: border 0.3s;
    }
    
    input:focus, select:focus, textarea:focus {
      border-color: #3498db !important;
      outline: none;
    }
    
    .login-form {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 8px;
      max-width: 350px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .login-form input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: none;
    }
    
    .login-form button {
      width: 100%;
      padding: 10px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .login-form button:hover {
      background: #2980b9;
    }
    
    .login-form button:disabled {
      background: #95a5a6;
      cursor: not-allowed;
    }
    
    .request-form {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      max-width: 800px;
      margin: 0 auto;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    
    .form-group textarea {
      min-height: 100px;
    }
    
    .submit-btn {
      width: 100%;
      padding: 15px;
      background: #2ecc71;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .submit-btn:hover {
      background: #27ae60;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .loading-spinner {
      text-align: center;
      padding: 20px;
      color: #3498db;
    }
    
    .error-msg {
      color: #e74c3c;
      text-align: center;
      padding: 20px;
    }
    
    /* Responsive */
    @media (max-width: 992px) {
      .header-content {
        flex-direction: column;
      }
      
      .login-form {
        width: 100%;
        max-width: 100%;
        margin-top: 20px;
      }
    }
    
    @media (max-width: 768px) {
      .pricing-tables {
        grid-template-columns: 1fr;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      h2 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">انتقل إلى المحتوى الرئيسي</a>
  <header role="banner">
    <div class="container">
      <div class="header-content">
        <div style="text-align: right;">
          <h1>LeenClasses - منصتك التعليمية الذكية</h1>
          <p style="font-size: 1.2rem; max-width: 800px; margin: 10px 0;">الحل المتكامل لإدارة التدريس عبر الإنترنت مع تقارير أداء متقدمة</p>
        </div>
        <div class="login-form">
          <h3 style="color: white; margin-bottom: 15px; text-align: center;">تسجيل الدخول</h3>
          <form id="loginForm">
            <div class="form-group">
              <label for="loginEmail">البريد الإلكتروني</label>
              <input type="email" id="loginEmail" placeholder="example@domain.com" required autocomplete="email">
            </div>
            <div class="form-group">
              <label for="loginPassword">كلمة المرور</label>
              <input type="password" id="loginPassword" placeholder="أدخل كلمة المرور" required autocomplete="current-password">
            </div>
            <button type="submit" id="loginBtn">دخول</button>
            <div id="loginError" class="error-message" style="display: none;"></div>
          </form>
          <p style="margin-top: 10px; font-size: 0.9rem; text-align: center;">
            <a href="#" id="forgotPassword" style="color: white;">نسيت كلمة المرور؟</a> | 
            <a href="#" id="signupLink" style="color: white;">تسجيل جديد</a>
          </p>
        </div>
      </div>
    </div>
  </header>
  
  <main id="main-content" role="main">
    <div class="container">
      <section>
        <h2>مميزات المنصة</h2>
        <div class="features-grid">
          <div class="feature-card" role="article">
            <div class="feature-icon">
              <i class="fas fa-chart-line" aria-hidden="true"></i>
            </div>
            <h3>تقارير أداء متقدمة</h3>
            <p>احصل على تحليلات مفصلة عن أداء كل طالب، معدلات الحضور، التقدم في المواد، وتقارير مقارنة مع زملائه</p>
          </div>
          
          <div class="feature-card" role="article">
            <div class="feature-icon">
              <i class="fas fa-user-tie" aria-hidden="true"></i>
            </div>
            <h3>إدارة متكاملة للمدرسين</h3>
            <p>نظام متكامل لإدارة فريق التدريس، توزيع المواد، تقييم الأداء، ومتابعة الجداول الزمنية</p>
          </div>
          
          <div class="feature-card" role="article">
            <div class="feature-icon">
              <i class="fas fa-money-bill-wave" aria-hidden="true"></i>
            </div>
            <h3>نظام مالي متكامل</h3>
            <p>إدارة الفواتير، المدفوعات، العمولات، والتقارير المالية مع دعم متعدد طرق الدفع</p>
          </div>
          
          <div class="feature-card" role="article">
            <div class="feature-icon">
              <i class="fas fa-video" aria-hidden="true"></i>
            </div>
            <h3>فصل افتراضي متكامل</h3>
            <p>بث حي عالي الجودة، تسجيلات تلقائية، سبورة تفاعلية، ومشاركة شاشة مع أدوات تعليمية متقدمة</p>
          </div>
          
          <div class="feature-card" role="article">
            <div class="feature-icon">
              <i class="fas fa-mobile-alt" aria-hidden="true"></i>
            </div>
            <h3>تطبيق جوال للطلاب</h3>
            <p>تطبيق خاص بمنصتك على متجري آب ستور وجوجل بلاي باسمك وشعارك لطلابك</p>
          </div>
          
          <div class="feature-card" role="article">
            <div class="feature-icon">
              <i class="fas fa-headset" aria-hidden="true"></i>
            </div>
            <h3>دعم فني متخصص</h3>
            <p>فريق دعم فني متخصص في المنصات التعليمية متاح 24/7 عبر الهاتف، البريد الإلكتروني والدردشة المباشرة</p>
          </div>
        </div>
      </section>
      
      <section>
        <h2>باقاتنا الشاملة</h2>
        <p style="text-align: center; margin-bottom: 30px; font-size: 1.1rem;">اختر الباقة التي تناسب احتياجاتك بناءً على عدد الطلاب ومستوى الخدمات والدعم</p>
        
        <div class="pricing-tables" id="pricingContainer">
          <!-- سيتم ملؤه ديناميكياً من Firebase -->
        </div>
      </section>
      
      <section style="background: #f8f9fa; padding: 50px 20px; margin-top: 40px;">
        <div class="container">
          <h2 style="text-align: center; border: none;">طلب نسخة تجريبية من LeenClasses</h2>
          <div class="request-form">
            <form id="contactForm">
              <div class="form-grid">
                <div class="form-group">
                  <label for="fullName">الاسم الكامل</label>
                  <input type="text" id="fullName" required aria-required="true">
                </div>
                <div class="form-group">
                  <label for="email">البريد الإلكتروني</label>
                  <input type="email" id="email" required aria-required="true">
                </div>
                <div class="form-group">
                  <label for="phone">رقم الهاتف</label>
                  <input type="tel" id="phone" required aria-required="true">
                </div>
                <div class="form-group">
                  <label for="organization">اسم المؤسسة/المدرسة</label>
                  <input type="text" id="organization">
                </div>
                <div class="form-group">
                  <label for="studentsCount">عدد الطلاب المتوقع</label>
                  <select id="studentsCount" required aria-required="true">
                    <option value="أقل من 50">أقل من 50</option>
                    <option value="50 - 150">50 - 150</option>
                    <option value="150 - 300">150 - 300</option>
                    <option value="أكثر من 300">أكثر من 300</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="plan">الباقة المطلوبة</label>
                  <select id="plan" required aria-required="true">
                    <option value="الباقة الأساسية">الباقة الأساسية</option>
                    <option value="الباقة المتقدمة">الباقة المتقدمة</option>
                    <option value="الباقة الاحترافية">الباقة الاحترافية</option>
                    <option value="غير متأكد - أريد المشورة">غير متأكد - أريد المشورة</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label for="notes">ملاحظات إضافية</label>
                <textarea id="notes"></textarea>
              </div>
              <button type="submit" class="submit-btn">إرسال الطلب</button>
            </form>
          </div>
        </div>
      </section>
      
      <section>
        <h2>نظام التقارير المتقدم</h2>
        <div class="features-grid">
          <div class="feature-card" role="article">
            <div class="feature-icon">
              <i class="fas fa-user-graduate" aria-hidden="true"></i>
            </div>
            <h3>تقارير الطلاب</h3>
            <p>تتبع تقدم كل طالب في كل مادة، معدل الحضور، المشاركة، والواجبات مع إشعارات للطلاب المتعثرين</p>
          </div>
          
          <div class="feature-card" role="article">
            <div class="feature-icon">
              <i class="fas fa-chart-pie" aria-hidden="true"></i>
            </div>
            <h3>تحليلات المواد</h3>
            <p>تحليل أداء الطلاب في كل مادة، تحديد نقاط القوة والضعف، ومقارنة الأداء بين الفصول</p>
          </div>
          
          <div class="feature-card" role="article">
            <div class="feature-icon">
              <i class="fas fa-file-invoice-dollar" aria-hidden="true"></i>
            </div>
            <h3>تقارير مالية</h3>
            <p>تقارير مفصلة عن الإيرادات، المصروفات، المدفوعات المستحقة، وتحليلات الربحية</p>
          </div>
        </div>
      </section>
      
      <section>
        <h2>آراء عملائنا</h2>
        <div class="testimonials" id="testimonialsContainer">
          <!-- سيتم ملؤه ديناميكياً من Firebase -->
        </div>
      </section>
      
      <section>
        <h2>الأسئلة الشائعة</h2>
        <div class="faq-item" role="article">
          <div class="faq-question" role="button" aria-expanded="false" aria-controls="faq1-answer" tabindex="0">
            <span>هل يمكنني تغيير الباقة لاحقًا؟</span>
            <i class="fas fa-chevron-down" aria-hidden="true"></i>
          </div>
          <div class="faq-answer" id="faq1-answer" role="region">
            <p>نعم، يمكنك الترقية أو التخفيض بين الباقات في أي وقت حسب احتياجاتك، وسيتم تعديل الفاتورة بشكل تناسبي.</p>
          </div>
        </div>
        
        <div class="faq-item" role="article">
          <div class="faq-question" role="button" aria-expanded="false" aria-controls="faq2-answer" tabindex="0">
            <span>ما هي طرق الدفع المتاحة؟</span>
            <i class="fas fa-chevron-down" aria-hidden="true"></i>
          </div>
          <div class="faq-answer" id="faq2-answer" role="region">
            <p>نحن نقبل الدفع بواسطة البطاقات الائتمانية (فيزا/ماستركارد)، التحويل البنكي، فودافون كاش، وحسابات PayPal.</p>
          </div>
        </div>
        
        <div class="faq-item" role="article">
          <div class="faq-question" role="button" aria-expanded="false" aria-controls="faq3-answer" tabindex="0">
            <span>هل هناك فترة تجريبية؟</span>
            <i class="fas fa-chevron-down" aria-hidden="true"></i>
          </div>
          <div class="faq-answer" id="faq3-answer" role="region">
            <p>نعم، نقدم 14 يوم تجريبي مجاني لجميع الباقات لتجربة المنصة قبل الاشتراك.</p>
          </div>
        </div>
        
        <div class="faq-item" role="article">
          <div class="faq-question" role="button" aria-expanded="false" aria-controls="faq4-answer" tabindex="0">
            <span>كيف يتم دعم وتدريب فريقنا؟</span>
            <i class="fas fa-chevron-down" aria-hidden="true"></i>
          </div>
          <div class="faq-answer" id="faq4-answer" role="region">
            <p>نوفر جلسات تدريبية عبر الإنترنت، أدلة استخدام مفصلة، وفريق دعم فني متخصص لضمان استفادتك القصوى من المنصة.</p>
          </div>
        </div>
      </section>
      
      <section style="text-align: center; margin-top: 60px; background: #f8f9fa; padding: 40px; border-radius: 10px;">
        <h2 style="border: none;">جاهز لبدء منصتك التعليمية؟</h2>
        <p style="font-size: 1.2rem; margin-bottom: 30px;">سجل الآن واحصل على شهرين مجانًا عند الاشتراك السنوي</p>
        <a href="#" class="cta" style="max-width: 300px; margin: 0 auto; font-size: 1.2rem; padding: 20px;">
          ابدأ تجربتك المجانية الآن
        </a>
      </section>
    </div>
  </main>
  
  <footer role="contentinfo">
    <div class="container">
      <div style="margin-bottom: 30px;">
        <h2 style="color: white; border: none;">LeenClasses</h2>
        <p>منصتك التعليمية المتكاملة لإدارة التدريس عبر الإنترنت</p>
      </div>
      
      <nav class="footer-links" role="navigation">
        <a href="#">الصفحة الرئيسية</a>
        <a href="#">المميزات</a>
        <a href="#">الباقات</a>
        <a href="#">تواصل معنا</a>
        <a href="#">شروط الاستخدام</a>
        <a href="#">سياسة الخصوصية</a>
      </nav>
      
      <div class="social-icons">
        <a href="#" aria-label="فيسبوك"><i class="fab fa-facebook" aria-hidden="true"></i></a>
        <a href="#" aria-label="تويتر"><i class="fab fa-twitter" aria-hidden="true"></i></a>
        <a href="#" aria-label="إنستجرام"><i class="fab fa-instagram" aria-hidden="true"></i></a>
        <a href="#" aria-label="لينكد إن"><i class="fab fa-linkedin" aria-hidden="true"></i></a>
        <a href="#" aria-label="يوتيوب"><i class="fab fa-youtube" aria-hidden="true"></i></a>
      </div>
      
      <div style="margin-top: 30px; color: #bdc3c7; font-size: 0.9rem;">
        <p>© 2023 LeenClasses. جميع الحقوق محفوظة</p>
      </div>
    </div>
  </footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>

  <script>
    // التهيئة باستخدام بياناتك
    const firebaseConfig = {
      apiKey: "AIzaSyCdqZzMGmJs6PrhF3mVzoM8FlUSamh1FO0",
      authDomain: "leeneduclasses-2022.firebaseapp.com",
      projectId: "leeneduclasses-2022",
      storageBucket: "leeneduclasses-2022.firebasestorage.app",
      messagingSenderId: "850348851753",
      appId: "1:850348851753:web:278a2902dc2696268b9238",
      measurementId: "G-WEK2KG58NM"
    };

      // Initialize Firebase
      const app = firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();
    // Enhanced login function
  document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    const loginBtn = document.getElementById('loginBtn');
    const errorElement = document.getElementById('loginError');
    
    // Reset error message
    errorElement.style.display = 'none';
    errorElement.textContent = '';
    
    // Validate inputs
    if (!email || !password) {
      showError('الرجاء إدخال البريد الإلكتروني وكلمة المرور');
      return;
    }
    
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      showError('صيغة البريد الإلكتروني غير صالحة');
      return;
    }
    
    if (password.length < 6) {
      showError('كلمة المرور يجب أن تكون 6 أحرف على الأقل');
      return;
    }
    
    // Disable button during login attempt
    loginBtn.disabled = true;
    loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري تسجيل الدخول...';
    
    try {
      // Sign in with email and password
      const userCredential = await auth.signInWithEmailAndPassword(email, password);
      const user = userCredential.user;
      
      // Check if email is verified (if required)
      if (!user.emailVerified) {
        await auth.signOut();
        showError('الرجاء تفعيل حسابك عبر الرابط المرسل إلى بريدك الإلكتروني');
        return;
      }
      
      // Login successful - redirect to dashboard
      window.location.href = 'dashboard.html';
      
    } catch (error) {
      console.error('Login error:', error);
      handleLoginError(error);
    } finally {
      loginBtn.disabled = false;
      loginBtn.textContent = 'دخول';
    }
  });

  function showError(message) {
    const errorElement = document.getElementById('loginError');
    errorElement.textContent = message;
    errorElement.style.display = 'block';
  }

  function handleLoginError(error) {
    let errorMessage = 'حدث خطأ أثناء تسجيل الدخول';
    
    switch(error.code) {
      case 'auth/invalid-login-credentials':
      case 'auth/user-not-found':
      case 'auth/wrong-password':
        errorMessage = 'البريد الإلكتروني أو كلمة المرور غير صحيحة';
        break;
      case 'auth/too-many-requests':
        errorMessage = 'تم تجاوز عدد المحاولات المسموح بها. الرجاء المحاولة لاحقاً';
        break;
      case 'auth/user-disabled':
        errorMessage = 'هذا الحساب معطل. الرجاء التواصل مع الدعم الفني';
        break;
      default:
        errorMessage = error.message || errorMessage;
    }
    
    showError(errorMessage);
  }

  // Password reset functionality
  document.getElementById('forgotPassword').addEventListener('click', async (e) => {
    e.preventDefault();
    const email = prompt('الرجاء إدخال بريدك الإلكتروني لإرسال رابط إعادة التعيين:');
    
    if (email) {
      try {
        await auth.sendPasswordResetEmail(email);
        alert('تم إرسال رابط إعادة تعيين كلمة المرور إلى بريدك الإلكتروني');
      } catch (error) {
        alert('حدث خطأ: ' + (error.message || 'تعذر إرسال رابط التعيين'));
      }
    }
  });

  // Check if user is already logged in
  auth.onAuthStateChanged((user) => {
    if (user) {
      // User is signed in, redirect to dashboard
      window.location.href = 'dashboard.html';
    }
  });
    // اختبار الاتصال
    async function testFirebaseConnection() {
      try {
        const testRef = db.collection('connectionTest').doc('testDoc');
        await testRef.set({
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          message: "Testing Firebase Connection"
        });
        
        const doc = await testRef.get();
        console.log("✅ اتصال Firebase ناجح:", doc.data());
        return true;
      } catch (error) {
        console.error("❌ فشل الاتصال بـ Firebase:", error);
        return false;
      }
    }

    // تنفيذ الاختبار عند تحميل الصفحة
    window.addEventListener('load', async () => {
      const isConnected = await testFirebaseConnection();
      if (!isConnected) {
        alert("حدث خطأ في الاتصال بقاعدة البيانات. الرجاء التحقق من console لمزيد من التفاصيل.");
      }
    });

    // دالة لتحميل الباقات من Firebase
    async function loadPricingPlans() {
      const pricingContainer = document.getElementById('pricingContainer');
      
      try {
        const querySnapshot = await db.collection("pricingPlans").orderBy("order").get();
        
        if (querySnapshot.empty) {
          pricingContainer.innerHTML = `<p class="no-data">لا توجد باقات متاحة حالياً</p>`;
          return;
        }

        pricingContainer.innerHTML = querySnapshot.docs.map(doc => {
          const plan = doc.data();
          return `
            <div class="pricing-table ${plan.popular ? 'popular' : ''}" role="article">
              ${plan.popular ? '<div class="popular-tag">الأكثر شيوعاً</div>' : ''}
              <div class="pricing-header">
                <h3>${plan.name}</h3>
                <div class="price">${plan.price} <span>${plan.currency}/شهر</span></div>
              </div>
              <div class="pricing-body">
                <ul class="pricing-features">
                  ${plan.features.map(f => `
                    <li class="${f.available ? '' : 'disabled'}">${f.text}</li>
                  `).join('')}
                </ul>
                <a href="#" class="cta" aria-label="اشترك في باقة ${plan.name}">اشترك الآن</a>
              </div>
            </div>
          `;
        }).join('');
      } catch (error) {
        pricingContainer.innerHTML = `
          <div class="error-msg">
            خطأ في تحميل الباقات: ${error.message}
          </div>
        `;
      }
    }

    // دالة لتحميل آراء العملاء من Firebase
    async function loadTestimonials() {
      const container = document.getElementById('testimonialsContainer');
      
      try {
        const querySnapshot = await db.collection("testimonials")
          .where("approved", "==", true)
          .limit(4)
          .get();

        container.innerHTML = querySnapshot.docs.map(doc => {
          const testimonial = doc.data();
          return `
            <div class="testimonial" role="article">
              <div class="testimonial-header">
                <img src="${testimonial.photoURL || 'https://i.imgur.com/JQWUQfG.png'}" 
                     class="testimonial-img" 
                     alt="${testimonial.name || 'عميل'}">
                <div>
                  <h4>${testimonial.name}</h4>
                  <div class="testimonial-rating" aria-label="التقييم ${testimonial.rating} من 5">
                    ${'★'.repeat(testimonial.rating)}${'☆'.repeat(5 - testimonial.rating)}
                  </div>
                </div>
              </div>
              <p>"${testimonial.text}"</p>
            </div>
          `;
        }).join('');
      } catch (error) {
        container.innerHTML = `
          <div class="error-msg">
            خطأ في تحميل آراء العملاء: ${error.message}
          </div>
        `;
      }
    }

    // دالة لإعداد نموذج الاتصال
    function setupContactForm() {
      const contactForm = document.getElementById('contactForm');
      
      if (!contactForm) return;
      
      contactForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = {
          fullName: document.getElementById('fullName').value.trim(),
          email: document.getElementById('email').value.trim(),
          phone: document.getElementById('phone').value.trim(),
          organization: document.getElementById('organization').value.trim(),
          studentsCount: document.getElementById('studentsCount').value,
          plan: document.getElementById('plan').value,
          notes: document.getElementById('notes').value.trim(),
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        const submitBtn = contactForm.querySelector('.submit-btn');
        
        try {
          // التحقق من صحة المدخلات
          if (!formData.fullName || !formData.email || !formData.phone) {
            throw new Error('الرجاء ملء جميع الحقول المطلوبة');
          }
          
          if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email)) {
            throw new Error('صيغة البريد الإلكتروني غير صالحة');
          }
          
          // تعطيل الزر أثناء المعالجة
          submitBtn.disabled = true;
          submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإرسال...';
          
          // حفظ البيانات في Firebase
          await db.collection("contactRequests").add(formData);
          
          // إعادة تعيين النموذج
          contactForm.reset();
          alert('تم إرسال طلبك بنجاح! سنتواصل معك قريباً.');
          
        } catch (error) {
          console.error('Error submitting contact form:', error);
          alert(error.message || 'حدث خطأ أثناء إرسال الطلب. الرجاء المحاولة مرة أخرى.');
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'إرسال الطلب';
        }
      });
    }

    // دالة لإعداد الأسئلة الشائعة
    function setupFAQ() {
      const faqItems = document.querySelectorAll('.faq-item');
      
      if (!faqItems.length) return;
      
      faqItems.forEach(item => {
        const question = item.querySelector('.faq-question');
        
        question.addEventListener('click', () => {
          // إغلاق جميع العناصر الأخرى
          faqItems.forEach(otherItem => {
            if (otherItem !== item && otherItem.classList.contains('active')) {
              otherItem.classList.remove('active');
              otherItem.querySelector('.faq-question i').className = 'fas fa-chevron-down';
              otherItem.querySelector('.faq-question').setAttribute('aria-expanded', 'false');
            }
          });
          
          // تبديل العنصر الحالي
          item.classList.toggle('active');
          const icon = question.querySelector('i');
          const isExpanded = item.classList.contains('active');
          icon.className = isExpanded ? 'fas fa-chevron-up' : 'fas fa-chevron-down';
          question.setAttribute('aria-expanded', isExpanded.toString());
        });

        // Enable keyboard navigation
        question.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            question.click();
          }
        });
      });
    }

    // دالة تسجيل الدخول المحسنة
    function setupLoginForm() {
      const loginForm = document.getElementById('loginForm');
      if (!loginForm) return;

      const forgotPassword = document.getElementById('forgotPassword');
      const signupLink = document.getElementById('signupLink');
      
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;
        const submitBtn = loginForm.querySelector('button[type="submit"]');
        
        try {
          // التحقق من صحة المدخلات
          if (!email || !password) {
            throw new Error('الرجاء إدخال البريد الإلكتروني وكلمة المرور');
          }
          
          if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            throw new Error('صيغة البريد الإلكتروني غير صالحة');
          }
          
          if (password.length < 8) {
            throw new Error('كلمة المرور يجب أن تكون 8 أحرف على الأقل');
          }
          
          // تعطيل الزر أثناء المعالجة
          submitBtn.disabled = true;
          submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري التسجيل...';
          
          // محاولة تسجيل الدخول
          const userCredential = await auth.signInWithEmailAndPassword(email, password);
          const user = userCredential.user;
          
          // توجيه المستخدم إلى لوحة التحكم
          window.location.href = `dashboard.html?uid=${user.uid}`;
          
        } catch (error) {
          console.error('خطأ في تسجيل الدخول:', error);
          
          let errorMessage = 'حدث خطأ أثناء التسجيل';
          switch(error.code) {
            case 'auth/user-not-found':
              errorMessage = 'لا يوجد حساب مرتبط بهذا البريد الإلكتروني';
              break;
            case 'auth/wrong-password':
              errorMessage = 'كلمة المرور غير صحيحة';
              break;
            case 'auth/too-many-requests':
              errorMessage = 'تم تجاوز عدد المحاولات المسموح بها. الرجاء المحاولة لاحقاً';
              break;
            default:
              errorMessage = error.message || errorMessage;
          }
          
          alert(errorMessage);
        } finally {
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = 'دخول';
          }
        }
      });
      
      // إعادة تعيين كلمة المرور
      if (forgotPassword) {
        forgotPassword.addEventListener('click', async (e) => {
          e.preventDefault();
          const email = prompt('الرجاء إدخال بريدك الإلكتروني لإرسال رابط إعادة التعيين:');
          
          if (email) {
            try {
              await auth.sendPasswordResetEmail(email);
              alert('تم إرسال رابط إعادة تعيين كلمة المرور إلى بريدك الإلكتروني');
            } catch (error) {
              alert('حدث خطأ: ' + (error.message || 'تعذر إرسال رابط التعيين'));
            }
          }
        });
      }
      
      // رابط التسجيل الجديد
      if (signupLink) {
        signupLink.addEventListener('click', (e) => {
          e.preventDefault();
          alert('سيتم توجيهك إلى صفحة التسجيل قريباً');
          // window.location.href = 'signup.html';
        });
      }
    }

    // التحقق من حالة تسجيل الدخول مع استثناء لصفحة index
    auth.onAuthStateChanged((user) => {
      // إذا كان المستخدم مسجل الدخول وكان في صفحة index
      if (user && window.location.pathname.endsWith('index.html')) {
        // عرض خيار للمستخدم بدلاً من إعادة التوجيه التلقائي
        const confirmRedirect = confirm('أنت مسجل الدخول بالفعل. هل تريد الانتقال إلى لوحة التحكم؟');
        if (confirmRedirect) {
          window.location.href = `dashboard.html?uid=${user.uid}`;
        }
      }
    });

    // تهيئة الصفحة عند التحميل
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('جاري تحميل البيانات...');
      
      try {
        await loadPricingPlans();
        await loadTestimonials();
        setupContactForm();
        setupFAQ();
        setupLoginForm();
        
        console.log('تم تحميل جميع البيانات بنجاح');
      } catch (error) {
        console.error('Error initializing page:', error);
      }
    });
  </script>
</body>
</html>